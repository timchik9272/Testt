<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Войти / Регистрация — vyy</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <style>
    :root{
      --bg:#f7f8fa; --card:#ffffff; --text:#1f2937; --muted:#6b7280;
      --primary:#3b82f6; --primary-600:#2563eb; --ring:rgba(59,130,246,.35);
      --shadow:0 6px 18px rgba(0,0,0,.08);
      --radius:14px;
    }
    *{box-sizing:border-box}
    body{
      margin:0; background:var(--bg); color:var(--text);
      font-family: ui-sans-serif, -apple-system, Segoe UI, Roboto, Inter, system-ui, Arial;
      min-height:100dvh; display:grid; place-items:center; padding:22px;
    }
    .card{
      width:100%; max-width:420px; background:var(--card); border-radius:var(--radius); box-shadow:var(--shadow);
      padding:18px;
    }
    h1{margin:0 0 6px 0; font-size:22px}
    p{margin:0 0 12px 0; color:var(--muted)}
    label{display:block; font-size:13px; color:var(--muted); margin-top:8px}
    input{
      width:100%; padding:12px 14px; font-size:16px; margin-top:6px;
      border:1px solid #e5e7eb; border-radius:12px; outline:0; background:#fff;
      transition:border-color .15s, box-shadow .15s;
    }
    input:focus{border-color:var(--primary); box-shadow:0 0 0 4px var(--ring)}
    .btn{
      width:100%; padding:13px 16px; border:0; border-radius:12px; cursor:pointer;
      background:var(--primary); color:#fff; font-size:16px; font-weight:700;
      transition:transform .05s ease, background .15s ease; margin-top:12px;
    }
    .btn:hover{background:var(--primary-600)}
    .tabs{display:flex; gap:8px; margin-bottom:8px}
    .tab{
      flex:1; text-align:center; padding:10px; border-radius:12px; background:#f3f4f6; cursor:pointer; font-weight:700;
    }
    .tab.active{background:#e0e7ff; color:#3730a3}
    .back{display:inline-block; margin-top:10px; color:#111827; text-decoration:none; font-weight:700}
    .note{font-size:12px; color:var(--muted); margin-top:8px}
  </style>
</head>
<body>
  <div class="card">
    <h1>Войти / Регистрация</h1>
    <p>Сессия сохраняется, админ определяется по UID.</p>

    <div class="tabs">
      <div id="tabLogin" class="tab active">Вход</div>
      <div id="tabSignup" class="tab">Регистрация</div>
    </div>

    <div id="formLogin">
      <label>Email</label>
      <input type="email" id="loginEmail" placeholder="you@example.com" />
      <label>Пароль</label>
      <input type="password" id="loginPass" placeholder="••••••••" />
      <button class="btn" id="btnLogin">Войти</button>
    </div>

    <div id="formSignup" style="display:none">
      <label>Email</label>
      <input type="email" id="signupEmail" placeholder="you@example.com" />
      <label>Пароль</label>
      <input type="password" id="signupPass" placeholder="минимум 6 символов" />
      <button class="btn" id="btnSignup">Создать аккаунт</button>
      <div class="note">Если включено подтверждение email — проверьте почту.</div>
    </div>

    <a href="/" class="back">← На главную</a>
  </div>

  <script>
    const SUPABASE_URL = "https://jkjahrrewfrcnfojpetn.supabase.co";
    const SUPABASE_KEY = "sb_secret_EERwpmVgF9JtXjDX8dkGig_BpPBPRx0";
    const sb = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

    const tabLogin = document.getElementById("tabLogin");
    const tabSignup = document.getElementById("tabSignup");
    const formLogin = document.getElementById("formLogin");
    const formSignup = document.getElementById("formSignup");

    function setTab(which){
      if(which === 'login'){
        tabLogin.classList.add('active'); tabSignup.classList.remove('active');
        formLogin.style.display = 'block'; formSignup.style.display = 'none';
      } else {
        tabSignup.classList.add('active'); tabLogin.classList.remove('active');
        formSignup.style.display = 'block'; formLogin.style.display = 'none';
      }
    }
    tabLogin.onclick = ()=> setTab('login');
    tabSignup.onclick = ()=> setTab('signup');

    document.getElementById("btnLogin").onclick = async () => {
      const email = document.getElementById("loginEmail").value.trim();
      const password = document.getElementById("loginPass").value;
      const { error } = await sb.auth.signInWithPassword({ email, password });
      if (error) { alert(error.message); return; }
      window.location.href = "/";
    };

    document.getElementById("btnSignup").onclick = async () => {
      const email = document.getElementById("signupEmail").value.trim();
      const password = document.getElementById("signupPass").value;
      const { error } = await sb.auth.signUp({ email, password });
      if (error) { alert(error.message); return; }
      alert("Регистрация успешна! Если требуется подтверждение — проверьте почту.");
      // Можно сразу вернуть на главную — сессия создастся после подтверждения (если включено)
      window.location.href = "/";
    };
  </script>
</body>
</html>
